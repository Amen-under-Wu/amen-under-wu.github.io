<!DOCTYPE html>
<html>
    <head>
        <meta name="description" content="å…«å­—æ’ç›˜ç½‘é¡µåŸå‹">
        <meta name="keywords" content="å…«å­—,æ’ç›˜,ç®—å‘½">
        <meta name="author" content="å¾…å®š">
        <meta charset="utf-8">
        <style type="text/css">
            .button {
                background-color: #f24030;
                border: none;
                color: white;
                padding: 15px 32px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                border-radius: 10px;
            }
            .button:hover {
                background-color: #b0372c;
            }
            #curtain {
                background-color: white;
                width: 200px;
                height: 0px;
                position: absolute;
                top: 0px;
                
            }
        </style>
        <script>
            
        </script>
        <title>å…«å­—æ’ç›˜é¡µ(demo)</title>
    </head>
    <body id="body" style="text-align: center;">
        <form id="form">
        </form>
        <button id="mainButton" class="button" onclick="mainFunc()">ç‚¹å‡»å¼€å§‹å…«å­—æ’ç›˜</button>
        <div id="resultBox" style="font-size: large; text-align: center;">
            ç»“æœå°†åœ¨æ­¤æ˜¾ç¤ºã€‚
        </div>
        <div style="font-size: small; text-align: center; color: gray;">
            <br><br><br>
            æ¸©é¦¨æç¤ºï¼šæœ¬ç«™æ‰€å¾—ç»“æœï¼Œä»…ä¾›å¨±ä¹å‚è€ƒæˆ–æ°‘ä¿—ç ”ç©¶ä¹‹ç”¨ï¼Œè¯·å‹¿è¿·ä¿¡ã€‚å› è¿·ä¿¡æµ‹è¯•ç»“æœè€Œé€ æˆçš„ä»»ä½•æŸå¤±ï¼Œæœ¬ç«™æ¦‚ä¸è´Ÿè´£ã€‚
        </div>
        <script src="lunar.js"></script>
        <script>
            function getQueryVariable(variable) {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i=0;i<vars.length;i++) {
                    var pair = vars[i].split("=");
                    if(pair[0] == variable){return pair[1];}
                }
                return(false);
            }
            var currentyear = new Date();
            currentyear = currentyear.getFullYear();
            var formstring = "<p>è¯·è¾“å…¥ç”Ÿè¾°åŠæ€§åˆ«ï¼š</p>";
            formstring += "<label for=\"year\">å¹´ï¼š</lable><select id=\"year\" name=\"year\">";
            for (let i = 1980; i <= currentyear; ++i) {
                formstring += "<option value=\"" + i + "\"" + (i == getQueryVariable("y") ? "selected" : "") + ">" + i + "</option>";
            }
            formstring += "</select>";
            formstring += "<label for=\"month\">æœˆï¼š</lable><select id=\"month\" name=\"month\">";
            for (let i = 1; i <= 12; ++i) {
                formstring += "<option value=\"" + i + "\"" + (i == getQueryVariable("m") ? "selected" : "") + ">" + i + "</option>";
            }
            formstring += "</select>";
            formstring += "<label for=\"day\">æ—¥ï¼š</lable><select id=\"day\" name=\"day\">";
            for (let i = 1; i <= 31; ++i) {
                formstring += "<option value=\"" + i + "\"" + (i == getQueryVariable("d") ? "selected" : "") + ">" + i + "</option>";
            }
            formstring += "</select>";
            formstring += "<br><label for=\"hour\">æ—¶ï¼ˆå‘ä¸‹å–æ•´ï¼‰ï¼š</lable><select id=\"hour\" name=\"hour\">";
            for (let i = 0; i < 24; ++i) {
                formstring += "<option value=\"" + i + "\"" + (i == getQueryVariable("h") ? "selected" : "") + ">" + i + "</option>";
            }
            formstring += "</select> <br> <label>æ€§åˆ«:</label><input type=\"radio\" id=\"male\" name=\"gender\" value=\"male\"" + (getQueryVariable("g") != "female" ? " checked" : "") + "><label for=\"male\">ç”·</label><input type=\"radio\" id=\"female\" name=\"gender\" value=\"female\"" + (getQueryVariable("g") == "female" ? " checked" : "") + "><label for=\"female\">å¥³</label>";
            document.getElementById("form").innerHTML = formstring;

            function keGan(lhs, rhs) {
                var gans = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]; //æœ¨ ç« åœŸ é‡‘ æ°´
                //æœ¨ åœŸ æ°´ ç« é‡‘
                //0 2 4 1 3
                var indexl = Math.floor(gans.indexOf(lhs) / 2);
                var indexr = Math.floor(gans.indexOf(rhs) / 2);
                if ((indexl - indexr + 5) % 5 == 3) {
                    return true;
                }
                else {
                    return false;
                }
            }
            function direction_expl(gan) {
                var gans = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]; //æœ¨ ç« åœŸ é‡‘ æ°´
                var directions = ["ä¸œæ–¹", "å—æ–¹", "ä¸­åŸ", "è¥¿æ–¹", "åŒ—æ–¹"];
                var explanations = [
                    "æ„¿ä¸œæ–¹çš„æ™¨æ›¦ä¸ºä½ å¸¦æ¥å¸Œæœ›çš„å…‰èŠ’ï¼Œå¦‚åŒä¸œæµ·çš„æ³¢æ¶›èˆ¬æ±¹æ¶Œæ¾æ¹ƒçš„çƒ­æƒ…ï¼Œæ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡æœæ°”ä¸æ´»åŠ›ã€‚æ„¿ä½ ä»¬çš„çˆ±æƒ…å¦‚ä¸œæ–¹æ˜ç èˆ¬ç’€ç’¨å¤ºç›®ï¼Œç»å¾—èµ·æ—¶é—´çš„è€ƒéªŒï¼Œæ„ˆå‘åšéŸ§ä¸çè´µã€‚",
                    "æ„¿å—æ–¹çš„çƒ­æƒ…å¦‚å¤æ—¥çš„é˜³å…‰ï¼Œæ¸©æš–ä½ çš„å¿ƒæˆ¿ï¼Œå¦‚åŒç æ±Ÿçš„æµæ°´ï¼Œç»µç»µä¸ç»ã€‚æ„¿ä½ ä»¬çš„çˆ±æƒ…å¦‚å—æ–¹çš„ç»¿æ„ç›ç„¶ï¼Œç”Ÿæœºå‹ƒå‹ƒï¼Œå³ä½¿ç»å†é£é›¨ï¼Œä¹Ÿä¾æ—§ç¹èŠ±ä¼¼é”¦ï¼Œæ˜¥æ„ç›ç„¶ã€‚",
                    "æ„¿ä¸­åŸçš„åšé‡å†å²ä¸ºä½ çš„çˆ±æƒ…å¢æ·»åº•è•´ä¸æ·±åº¦ï¼Œå¦‚åŒé»„æ²³çš„æµæ·Œï¼Œæºè¿œæµé•¿ã€‚æ„¿ä½ ä»¬çš„å…³ç³»å¦‚ä¸­åŸå¤§åœ°èˆ¬è‚¥æ²ƒï¼ŒåŸ¹è‚²å‡ºæœ€ç¾ä¸½çš„èŠ±æœµï¼Œæ„¿ä½ ä»¬çš„çˆ±æƒ…æ•…äº‹ï¼Œå¦‚åŒä¸­åŸçš„å¤éƒ½ï¼Œå†ç»æ²§æ¡‘ï¼Œå´æ„ˆå‘è¾‰ç…Œã€‚", 
                    "æ„¿è¥¿æ–¹çš„ä¸ç»¸ä¹‹è·¯å¸¦ç»™ä½ æ— é™çš„æ¢ç´¢ä¸å‘ç°ï¼Œå¦‚åŒè¥¿åŸŸçš„è¾½é˜”å¤©åœ°ï¼Œç»™äºˆä½ ä»¬çš„çˆ±æƒ…ä»¥å®½å¹¿çš„èƒ¸æ€€å’Œæ·±è¿œçš„è§†é‡ã€‚æ„¿ä½ ä»¬çš„å…³ç³»å¦‚å¤ä¸è·¯èˆ¬ï¼Œè¿æ¥å½¼æ­¤çš„å¿ƒçµï¼Œå…±åŒç»å†ç”Ÿæ´»çš„ä¸°å¯Œå¤šå½©ã€‚",
                    "æ„¿åŒ—æ–¹çš„é›ªå›½é£å…‰ä¸ºä½ å¸¦æ¥çº¯æ´ä¸åšéŸ§ï¼Œå¦‚åŒé•¿åŸçš„å·å³¨ï¼Œç»å¾—èµ·å²æœˆçš„æ´—ç¤¼ã€‚æ„¿ä½ ä»¬çš„çˆ±æƒ…å¦‚åŒ—æ–¹çš„å†¬æ—¥ï¼Œè™½ç„¶å¯’å†·ï¼Œå´æ›´åŠ æ˜¾å¾—æ¸©æš–è€Œçè´µï¼Œç»å¾—èµ·é£éœœï¼Œæ„ˆå‘åšå®šã€‚"
                ];
                var appearances = [
                    "æŒºæ‹”ç§€ä¸½ï¼Œè„¸è‰²é’ç™½ï¼Œè„¸éƒ¨çº¿æ¡åˆ†æ˜ã€‚",
                    "è‹—æ¡ç§€ä¸½ï¼Œçœ¼ç›æœ‰ç¥ï¼Œçš®è‚¤ç™½çš™èƒœé›ªã€‚",
                    "ç™½é‡Œé€çº¢ï¼Œæ˜çœ¸å–„çï¼Œæ€§æ ¼æ¯”è¾ƒçƒ­æƒ…ã€‚",
                    "çš®è‚¤çº¢æ¶¦ï¼Œè„¸å‹å°å·§ï¼Œå¤©ç”Ÿçµæ°”åè¶³ã€‚",
                    "è„¸æ–¹åšå®ï¼Œå¤§çœ¼æœ‰ç¥ï¼Œè„¸è‰²ç•¥å‘ç°ç™½ã€‚",
                    "é¢å¤´é¥±æ»¡ï¼ŒåŒçœ¼æ¸©å’Œï¼Œè„¸è‰²ç•¥æ˜¾æš—æ·¡ã€‚",
                    "çš®è‚¤ç™½çš™ï¼Œçœ¼ç›ç»†é•¿ï¼Œè„¸éƒ¨æ£±è§’åˆ†æ˜ã€‚",
                    "å¤šé¹…è›‹è„¸ï¼Œæçœ¼ç™½è‚¤ï¼Œå®¹é¢œæ°´çµç§€æ°”ã€‚",
                    "å¤šç“œå­è„¸ï¼Œçš®è‚¤äº®ç™½ï¼Œæ€§æ ¼çƒ­æƒ…å¼€æœ—ã€‚",
                    "æ–¹è„¸è‚‰å¤šï¼Œçœ¼ç¥æ¸…æ¾ˆï¼Œçš®è‚¤å…‰æ³½äº®ä¸½ã€‚",
                ];
                var index = Math.floor(gans.indexOf(gan) / 2);
                let result = [directions[index], explanations[index], appearances[gans.indexOf(gan)]];
                return result;
            }

            var zhis = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
            function chongZhi(lhs, rhs) {
                var indexl = zhis.indexOf(lhs);
                var indexr = zhis.indexOf(rhs);
                if (Math.abs(indexl - indexr) == 6) {
                    return true;
                }
                else {
                    return false;
                }
            }
            function heZhi(lhs, rhs) {
                var indexl = zhis.indexOf(lhs);
                var indexr = zhis.indexOf(rhs);
                if (indexl + indexr == 13 || indexl + indexr == 1) {
                    return true;
                }
                else {
                    return false;
                }
            }
            function xingZhi(lhs, rhs) {
                var indexl = zhis.indexOf(lhs);
                var indexr = zhis.indexOf(rhs);
                if (indexl == 0 && indexr == 3) return true;
                else if (indexl == 1 && indexr == 10) return true;
                else if (indexl == 2 && indexr == 5) return true;
                else if (indexl == 3 && indexr == 0) return true;
                else if (indexl == 4 && indexr == 4) return true;
                else if (indexl == 5 && indexr == 8) return true;
                else if (indexl == 6 && indexr == 6) return true;
                else if (indexl == 7 && indexr == 1) return true;
                else if (indexl == 8 && indexr == 2) return true;
                else if (indexl == 9 && indexr == 9) return true;
                else if (indexl == 10 && indexr == 7) return true;
                else if (indexl == 11 && indexr == 11) return true;
                else return false;
            }
            function haiZhi(lhs, rhs) {
                var indexl = zhis.indexOf(lhs);
                var indexr = zhis.indexOf(rhs);
                if (indexl + indexr == 7 || indexl + indexr == 19) return true;
                else return false;
            }
            function resultDescription(word) {
                switch (word) {
                case "å†²":
                    return "<br>åœ°æ”¯é€¢å†²ï¼Œè‰æœ¨èŒåŠ¨ï¼ä»Šå¹´å©šå§»å®«é€¢å†²ï¼Œå¾—è§ç¾äººï¼Œæ˜¥å¿ƒè¡æ¼¾ï¼ï½ï½èºåŠ¨ä¹‹ä½™ï¼Œå¯è¦å°å¿ƒè¢«è·å°”è’™å†²æ˜äº†å¤´è„‘å“Ÿï½åœ¨ç¾å¥½çš„æ—¥å¸¸ä¸­è°¨æ…åœ°ç»´ç³»è¿™æ®µæ„Ÿæƒ…å§ï¼";
                    break;
                case "åˆ":
                    return "<br>åœ°æ”¯ç›¸åˆï¼Œæƒ…æŠ•æ„åˆï¼ä»Šå¹´å©šå§»å®«é€¢åˆï¼Œæœºç¼˜ä¸Šé—¨ï¼ŒçœŸå‘½å¤©å­/å¥³ï¼Œæ¥åœ¨ä»Šå¹´ï¼ç¿çƒ‚ä¹‹æƒ…æ°å¦‚å¤æ—¥ç¹èŠ±ï¼Œè´åšä¹‹å¿ƒå¯æ¯”ç‰›éƒç»‡å¥³ï¼";
                    break;
                case "åˆ‘":
                case "å®³":
                    return "<br>åœ°æ”¯é€¢åˆ‘å®³ï¼Œå½“å¿ƒå—ç¾ï¼ä»Šå¹´å©šå§»å®«é€¢å®³ï¼Œä¸€æƒ…è¯·ä½œä¸¤æ–¹çœ‹ï¼ä¸€çœ‹å¯¹æ–¹é€‚åˆå¦ï¼Œè«å°†éª·é«…ä½œå¨‡å¨¥ï¼›ä¸€çœ‹è‡ªèº«å¹¸ç¦å¦ï¼Œè«æ•™çº¢é¢œä¼¤å¿ƒè‚ ï½ï½åœ¨æ¸…é†’ä¹‹åè°¨æ…åœ°å¯¹å¾…è¿™æ®µæ„Ÿæƒ…å§ï¼";
                    break;
                default:
                    return "";
                }
            }
            
            function mainFunc() {
                document.getElementById("resultBox").style = "text-align: left; margin: 15px; border: 5px; padding: 10px; width: auto; border-color: pink; border-style: groove;";
                var now = new Date();
                document.getElementById("resultBox").innerHTML = "";
                var my_y = document.forms["form"]["year"].value;
                var my_m = document.forms["form"]["month"].value;
                var my_d = document.forms["form"]["day"].value;
                var my_h = document.forms["form"]["hour"].value;
                let sex = (document.forms["form"]["gender"].value == 'female' ? 0 : 1);
                //alert(sex);
                var solar = Solar.fromYmdHms(my_y,my_m,my_d,my_h,0,0);
                var lunar = Lunar.fromDate(new Date(my_y, my_m - 1, my_d, my_h));
                var d = lunar.getEightChar();
                document.getElementById("resultBox").innerHTML += "ä½ çš„ç”Ÿè¾°å…«å­—ï¼š" + (d) + "<br>";
                // document.getElementById("resultBox").innerHTML += "<br>" + (d.getYearWuXing() + ', ' + d.getMonthWuXing() + ', ' + d.getDayWuXing() + ', ' + d.getTimeWuXing());
                // document.getElementById("resultBox").innerHTML += "<br>" + (d.getYearNaYin() + ', ' + d.getMonthNaYin() + ', ' + d.getDayNaYin() + ', ' + d.getTimeNaYin());
                // document.getElementById("resultBox").innerHTML += "<br>" + (d.getYearShiShenGan() + ', ' + d.getMonthShiShenGan() + ', ' + d.getDayShiShenGan() + ', ' + d.getTimeShiShenGan());

                // // å¹´æ”¯åç¥
                // document.getElementById("resultBox").innerHTML += "<br>" + ('å¹´æ”¯åç¥ = ' + d.getYearShiShenZhi());

                // // æœˆæ”¯åç¥
                // document.getElementById("resultBox").innerHTML += "<br>" + ('æœˆæ”¯åç¥ = ' + d.getMonthShiShenZhi());

                // // æ—¥æ”¯åç¥
                // document.getElementById("resultBox").innerHTML += "<br>" + ('æ—¥æ”¯åç¥ = ' + d.getDayShiShenZhi());

                // // æ—¶æ”¯åç¥
                // document.getElementById("resultBox").innerHTML += "<br>" + ('æ—¶æ”¯åç¥ = ' + d.getTimeShiShenZhi());

                // è·å–è¿
                var yun = d.getYun(sex);

                // èµ·è¿
                //document.getElementById("resultBox").innerHTML += "<br>" + ('å‡ºç”Ÿ' + yun.getStartYear() + 'å¹´' + yun.getStartMonth() + 'ä¸ªæœˆ' + yun.getStartDay() + 'å¤©åèµ·è¿');

                // è·å–å¤§è¿è¡¨
                var daYunArr = yun.getDaYun();
                var dayuncurr = 0;
                for (var i=0, j=daYunArr.length; i<j; i++) {
                    var daYun = daYunArr[i];
                    if (now.getFullYear() >= daYun.getStartYear()) {
                        dayuncurr = i;
                    }
                    //document.getElementById("resultBox").innerHTML += "<br>" + ('å¤§è¿[' + i + '] = ' + daYun.getStartYear() + 'å¹´ ' + daYun.getStartAge() + 'å² ' + daYun.getGanZhi());
                }
                var the_gan;
                for (let k = 0; k < 3; ++k) {
                    var LiuNianArr = daYunArr[dayuncurr + k].getLiuNian();
                    for (var i=0, j=LiuNianArr.length; i<j; i++) {
                        var liuNian = LiuNianArr[i];
                        var word = 0;
                        if (((keGan(liuNian.getGanZhi()[0], d.getDayGan()) && sex == 0) || (keGan(d.getDayGan(), liuNian.getGanZhi()[0]) && sex == 1)) && liuNian.getYear() >= now.getFullYear()){
                            the_gan = liuNian.getGanZhi()[0];
                            var rating = 50;
                            if (chongZhi(liuNian.getGanZhi()[1], d.getDayZhi())) {
                                word = "å†²";
                                rating = 80;
                                document.getElementById("resultBox").innerHTML += "<br>" + ('é‡è¦æµå¹´ï¼š' + liuNian.getYear() + 'å¹´ ' + liuNian.getAge() + 'å² ' + liuNian.getGanZhi());
                            }
                            else if (heZhi(liuNian.getGanZhi()[1], d.getDayZhi())) {
                                word = "åˆ";
                                rating = 100;
                                document.getElementById("resultBox").innerHTML += "<br>" + ('é‡è¦æµå¹´ï¼š' + liuNian.getYear() + 'å¹´ ' + liuNian.getAge() + 'å² ' + liuNian.getGanZhi());
                            }
                            else if (xingZhi(liuNian.getGanZhi()[1], d.getDayZhi())) {
                                word = "åˆ‘";
                                rating = 60;
                                document.getElementById("resultBox").innerHTML += "<br>" + ('é‡è¦æµå¹´ï¼š' + liuNian.getYear() + 'å¹´ ' + liuNian.getAge() + 'å² ' + liuNian.getGanZhi());
                            }
                            else if (haiZhi(liuNian.getGanZhi()[1], d.getDayZhi())) {
                                word = "å®³";
                                rating = 60;
                                document.getElementById("resultBox").innerHTML += "<br>" + ('é‡è¦æµå¹´ï¼š' + liuNian.getYear() + 'å¹´ ' + liuNian.getAge() + 'å² ' + liuNian.getGanZhi());
                            }
                            else //if ((keGan(liuNian.getGanZhi()[0], d.getDayGan()) && sex == 0) || (keGan(d.getDayGan(), liuNian.getGanZhi()[0]) && sex == 1))
                                document.getElementById("resultBox").innerHTML += "<br>" + ('é‡è¦æµå¹´ï¼š' + liuNian.getYear() + 'å¹´ ' + liuNian.getAge() + 'å² ' + liuNian.getGanZhi());
                            document.getElementById("resultBox").innerHTML += "<br>æ‹çˆ±æŒ‡æ•°ï¼š" + rating + "<br>æ­å–œæ­å–œäº²ğŸ‰ï¼šä»Šå¹´æ¡ƒèŠ±æ˜Ÿå½“ä¸´ï¼Œå¯æ˜¯åå¹´éš¾é‡çš„æœºç¼˜ä¹‹å¹´å“Ÿï½ä»Šå¹´æ¡ƒèŠ±è¿ä¸´é—¨ï¼Œæ˜¥é£åé‡Œé€ä½³äººã€‚æ¡ƒèŠ±è¿æ¥ï¼Œçˆ±æƒ…èŠ±å¼€ï¼›å§»ç¼˜å¤©å®šï¼Œå¹¸ç¦è‡ªæ¥ã€‚åœ¨è¿™ç¾å¥½çš„æ—¶å…‰é‡Œï¼Œæ”¶è·æ»¡æ»¡çš„çˆ±ä¸å¹¸ç¦å§ï¼" + resultDescription(word) + "<br>";
                            document.getElementById("resultBox").innerHTML += "TAçš„å¤–è²Œï¼š" + direction_expl(the_gan)[2] + "<br>";
                        }
                    }
                }
                document.getElementById("resultBox").innerHTML += "<br><br>ä½ çš„å®¿ä¸–æƒ…ç¼˜æ¥è‡ªï¼š" + direction_expl(the_gan)[0] + "<br>" + direction_expl(the_gan)[1];
                
            }
		</script>
    </body>
</html>
